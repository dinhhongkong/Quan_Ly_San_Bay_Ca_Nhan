USE [QL_SANBAY_CN]
GO
/****** Object:  StoredProcedure [dbo].[sp_BaoCaoMayBayBaoTri]    Script Date: 6/6/2023 11:17:15 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
ALTER PROC [dbo].[sp_BaoCaoMayBayBaoTri]
@tuNgay date, @denNgay date
AS
BEGIN
	SELECT IDPHIEU, IDMAYBAY, NGAYLAP, SOGIO INTO #PBT FROM PHIEUBAOTRI WHERE NGAYLAP BETWEEN @tuNgay AND @denNgay;
	SELECT #PBT.IDPHIEU, IDMAYBAY, NGAYLAP, SOGIO ,SONGUOI
	FROM #PBT
	INNER JOIN (SELECT CT.IDPHIEU, COUNT(CT.IDPHIEU) AS SONGUOI FROM CT_PHIEUBAOTRI CT GROUP BY CT.IDPHIEU )  CT_PBT 
	ON CT_PBT.IDPHIEU = #PBT.IDPHIEU
END