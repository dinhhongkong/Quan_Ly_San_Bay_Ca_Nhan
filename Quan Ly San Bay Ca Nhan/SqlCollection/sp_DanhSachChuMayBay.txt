USE [QL_SANBAY_CN]
GO
/****** Object:  StoredProcedure [dbo].[sp_DanhSachChuMayBay]    Script Date: 5/26/2023 3:27:38 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
ALTER PROC [dbo].[sp_DanhSachChuMayBay]
AS
SELECT OWNER_ID, CT_LMB.IDMAYBAY, TENLOAI, NGAYBATDAU
FROM (SELECT IDMAYBAY, TENLOAI
	  FROM MAYBAY MB
	  JOIN LOAIMAYBAY LMB
	  ON MB.IDLOAI = LMB.IDLOAI) CT_LMB
JOIN
(SELECT OWNER_ID, IDMAYBAY, NGAYBATDAU FROM
(Select OWNER_ID
		, IDMAYBAY
		, NGAYBATDAU
		, ROW_NUMBER() OVER (PARTITION BY IDMAYBAY ORDER BY NGAYBATDAU DESC) AS UUTIEN
FROM CT_CHUMAYBAY) LOC
WHERE LOC.UUTIEN = 1) CT_CMB
ON CT_LMB.IDMAYBAY = CT_CMB.IDMAYBAY