USE [QL_SANBAY_CN]
GO
/****** Object:  StoredProcedure [dbo].[sp_DanhSachChuMayBay]    Script Date: 6/1/2023 12:25:47 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROC [dbo].[sp_DanhSachChuMayBay]
AS
SELECT OWNER_ID, CT_LMB.IDMAYBAY, TENLOAI, ISNULL(NGAYBATDAU, '00:00:00 01/01/1900') AS NGAYBATDAU
FROM (SELECT IDMAYBAY, TENLOAI
	  FROM MAYBAY MB
	  JOIN LOAIMAYBAY LMB
	  ON MB.IDLOAI = LMB.IDLOAI) CT_LMB
LEFT JOIN
(SELECT OWNER_ID, IDMAYBAY, NGAYBATDAU FROM
(Select OWNER_ID
		, IDMAYBAY
		, NGAYBATDAU
		, ROW_NUMBER() OVER (PARTITION BY IDMAYBAY ORDER BY NGAYBATDAU DESC) AS UUTIEN
FROM CT_CHUMAYBAY) LOC
WHERE LOC.UUTIEN = 1) CT_CMB
ON CT_LMB.IDMAYBAY = CT_CMB.IDMAYBAY